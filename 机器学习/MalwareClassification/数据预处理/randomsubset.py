import os
from random import *
import pandas as pd
import shutil
import warnings

warnings.filterwarnings("ignore")

# 初始化随机数种子，默认当前系统时间,确定随机种子可以方便其他人复现数据
rs = Random()
rs.seed(1)

# 读取csv文件
trainlabels = pd.read_csv('../CSV/trainLabels.csv')
# 生成一个空列表和空二维表
fids = []
opd = pd.DataFrame()

# 根据Class值进行分组，并重新编号，再在每组中筛选100个样本
for clabel in range(1, 10):
    mids = trainlabels[trainlabels.Class == clabel]
    print(mids)
    # 重置索引
    mids = mids.reset_index(drop=True)
    rchoice = [rs.randint(0, len(mids) - 1) for i in range(10)]
    # 将筛选样本的ID值存储在rids列表中
    rids = [mids.loc[i].Id for i in rchoice]
    # fids存储所有样本的id信息
    fids.extend(rids)
    # 存储900个样本的id，class信息
    opd = opd.append(mids.loc[rchoice])

# 给900组样本重新编号
opd = opd.reset_index(drop=True)
opd.to_csv('../CSV/subtrainLabels.csv', encoding='utf-8', index=False)

sbase = "H:/恶意代码数据/train/"
tbase = "H:/恶意代码数据/subtrain/"

# 从训练集提取数据，到筛选的训练集
for fid in fids:
    fnames = ['{0}.asm'.format(fid), '{0}.bytes'.format(fid)]
    for fname in fnames:
        cspath = sbase + fname
        ctpath = tbase + fname
        shutil.copy(cspath, ctpath)